@model Avocado.Web.Models.SignInViewModel

@if (Request.IsAuthenticated)
{ 
    <span>Welcome @Context.User.Identity.Name</span> <span><a href="/Account/Logout">Logout</a></span>   
}
else
{
    <input id="register-button" type="button" value="New to CreativiMe? Join Today!" />
    <input id="login-button" type="button" value="Log In" />
    <input id="modal-button" type="button" value="test the modal" />
    
    <div id="myModal" class="reveal-modal xlarge">
        <div style="float:left;">
            <h2>CreativiMe<span>Login now and start sharing YOUR creativity!</span></h2>
            <p>
                @using (Html.BeginForm("Login","Account"))
                {
                    @Html.ValidationSummary(excludePropertyErrors: false, message: "", htmlAttributes: new { @class = "ui-state-error", style="width:325px; margin-bottom:20px;" })

                    @Html.LabelFor(x => x.Email)<br /> 
                    @Html.TextBoxFor(x => x.Email, new { @class = "form-input" })<br /><br />
        
                    @Html.LabelFor(x => x.Password)<br />
                    @Html.PasswordFor(x => x.Password, new { @class = "form-input" })<br /><br />
    
                    <div>
                        <input type="submit" value="Log In" />
                    </div>
                }
            </p>
            
        </div>
        

        <div style="float:right;">
            <h2>Got Facebook?<span>You can also log in with your Facebook account.</span></h2>
            <p>
                <fb:login-button 
                    autologoutlink="true"
                    size="large" 
                    perms="email,publish_stream">
                    Login with Facebook
                </fb:login-button>
            </p>
            <p>
                <input id="customFBLogin" type="button" value="My Custom FB Login" />
            </p>
        </div>

        <p><a class="close-reveal-modal">&#215;</a></p>
    </div>    
        
    <script type="text/javascript">
        window.fbAsyncInit = function () {
            FB.init({ appId: '183406445033444', status: true, cookie: true, xfbml: true });

            /* All the events registered */
            FB.Event.subscribe('auth.login', function (response) {
                // do something with response
                login();
            });
            FB.Event.subscribe('auth.logout', function (response) {
                // do something with response
                logout();
            });

            FB.getLoginStatus(function (response) {
                if (response.session) {
                    // logged in and connected user, someone you know
                    //login();
                    alert('You are logged into Facebook right now');
                }
            });
        };
        (function () {
            var e = document.createElement('script');
            e.type = 'text/javascript';
            e.src = document.location.protocol +
            '//connect.facebook.net/en_US/all.js';
            e.async = true;
            document.getElementById('fb-root').appendChild(e);
        } ());

        function login() {
            FB.api('/me', function (response) {
                window.location = '/Account/LogInWithFacebook/?facebookEmail=' + response.email;
            });
        }

        $(function () {
            $('#customFBLogin').click(function () {
                CustomButtonLogin();
            });
        });

        $(function () {
            $('#customTwitterLogin').click(function () {
                window.location = '/Account/SignInWithTwitter';
            });
        });

        function CustomButtonLogin() {
            FB.login(function (response) {
                if (response.session) {
                    if (response.perms) {
                        // user is logged in and granted some permissions.
                        // perms is a comma separated list of granted permissions
                    } else {
                        // user is logged in, but did not grant any permissions
                    }
                } else {
                    // user is not logged in
                }
            }, { perms: 'publish_stream,email' });
        }
        $(function () {
            $('input:button, input:submit').button();

            $('#register-button').click(function () {
                window.location = '/Account/CreateAccount';
            });

            $('#login-button').click(function () {
                window.location = '/Account/LogIn';
            });

            $('#modal-button').click(function (e) {
                e.preventDefault();
                $('#myModal').reveal({
                    animation: 'fadeAndPop',                   //fade, fadeAndPop, none
                    animationspeed: 400,                       //how fast animtions are
                    closeonbackgroundclick: true
                }); //.effect("bounce", { times: 2, distance: 10 }, 400);
            });
        });
    </script>
}